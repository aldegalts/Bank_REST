databaseChangeLog:
    - changeSet:
          id: 001-create-users-roles
          author: aldegalts
          changes:
              - createTable:
                    tableName: users
                    columns:
                        - column:
                              name: id
                              type: BIGINT
                              autoIncrement: true
                              constraints:
                                  primaryKey: true
                                  nullable: false
                        - column:
                              name: username
                              type: VARCHAR(255)
                              constraints:
                                  nullable: false
                        - column:
                              name: password
                              type: VARCHAR(255)
                              constraints:
                                  nullable: false
                        - column:
                              name: full_name
                              type: VARCHAR(255)
                        - column:
                              name: enabled
                              type: BOOLEAN
                              defaultValueBoolean: true
                        - column:
                              name: created_at
                              type: TIMESTAMP
                              defaultValueComputed: CURRENT_TIMESTAMP

              - createTable:
                    tableName: roles
                    columns:
                        - column:
                              name: id
                              type: BIGINT
                              autoIncrement: true
                              constraints:
                                  primaryKey: true
                                  nullable: false
                        - column:
                              name: name
                              type: VARCHAR(50)
                              constraints:
                                  nullable: false

              - createTable:
                    tableName: user_roles
                    columns:
                        - column:
                              name: user_id
                              type: BIGINT
                              constraints:
                                  nullable: false
                        - column:
                              name: role_id
                              type: BIGINT
                              constraints:
                                  nullable: false

              - addPrimaryKey:
                    tableName: user_roles
                    columnNames: user_id, role_id
                    constraintName: pk_user_roles

              - addForeignKeyConstraint:
                    baseTableName: user_roles
                    baseColumnNames: user_id
                    referencedTableName: users
                    referencedColumnNames: id
                    constraintName: fk_user_roles_user

              - addForeignKeyConstraint:
                    baseTableName: user_roles
                    baseColumnNames: role_id
                    referencedTableName: roles
                    referencedColumnNames: id
                    constraintName: fk_user_roles_role

              - addUniqueConstraint:
                    tableName: users
                    columnNames: username
                    constraintName: uq_users_username

              - addUniqueConstraint:
                    tableName: roles
                    columnNames: name
                    constraintName: uq_roles_name

          rollback:
              - dropTable:
                    tableName: user_roles
              - dropTable:
                    tableName: roles
              - dropTable:
                    tableName: users
